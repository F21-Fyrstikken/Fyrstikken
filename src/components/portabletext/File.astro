---
interface IFileProps {
  node: {
    asset: {
      _ref: string;
      url?: string;
    };
  };
}

const { node } = Astro.props as IFileProps;

function buildFileUrl(ref: string): string {
  const refWithoutPrefix = ref.replace(/^file-/, "");
  const lastDashIndex = refWithoutPrefix.lastIndexOf("-");
  const id = refWithoutPrefix.substring(0, lastDashIndex);
  const extension = refWithoutPrefix.substring(lastDashIndex + 1);
  const projectId = "531mn2v8";
  return `https://cdn.sanity.io/files/${projectId}/production/${id}.${extension}`;
}

const fileUrl = node.asset?.url || (node.asset?._ref ? buildFileUrl(node.asset._ref) : "");
const fileName = fileUrl.split("/").pop() || "Download file";
const extension = fileName.split(".").pop()?.toLowerCase() || "";
const isPdf = extension === "pdf";
---

{
  fileUrl && isPdf && (
    <div class="pdf-container">
      <div class="pdf-preview">
        <embed src={fileUrl} type="application/pdf" width="100%" height="600px">
          <p>
            PDF preview is not supported in your browser.
            <a href={fileUrl} target="_blank" rel="noopener noreferrer">√Öpne PDF i ny fane</a> eller
            <a href={fileUrl} download>last ned PDF</a>.
          </p>
        </embed>
      </div>
      <div class="pdf-actions">
        <a href={fileUrl} target="_blank" rel="noopener noreferrer">
          üëÅÔ∏è √Öpne i ny fane
        </a>
        <a href={fileUrl} download>
          üì• Last ned PDF
        </a>
      </div>
    </div>
  )
}

{
  fileUrl && !isPdf && (
    <div class="file-download">
      <a href={fileUrl} download target="_blank" rel="noopener noreferrer">
        üìé Lenke
      </a>
    </div>
  )
}

<style>
  .pdf-container {
    margin: 2.5rem 0;
    border: 2px solid light-dark(var(--light-ramme), var(--dark-ramme));
    border-radius: 12px;
    overflow: hidden;
    background: light-dark(var(--light-tekstBoks), var(--dark-tekstBoks));
  }

  .pdf-preview {
    width: 100%;
    min-height: 600px;
    background: white;
  }

  .pdf-preview embed {
    display: block;
    border: none;
  }

  .pdf-actions {
    display: flex;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    background: light-dark(var(--light-main), var(--dark-main));
    border-top: 2px solid light-dark(var(--light-ramme), var(--dark-ramme));
  }

  .pdf-actions a {
    color: light-dark(var(--light-safir), var(--dark-safir));
    text-decoration: none;
    font-weight: 500;
    font-size: 1rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border: 2px solid light-dark(var(--light-ramme), var(--dark-ramme));
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .pdf-actions a:hover {
    border-color: light-dark(var(--light-safir), var(--dark-safir));
    background: light-dark(var(--light-tekstBoks), var(--dark-tekstBoks));
  }

  .file-download {
    margin: 2rem 0;
    padding: 1.25rem 1.5rem;
    background: light-dark(var(--light-tekstBoks), var(--dark-tekstBoks));
    border-radius: 12px;
    border: 2px solid light-dark(var(--light-ramme), var(--dark-ramme));
    transition: all 0.2s ease;
  }

  .file-download:hover {
    border-color: light-dark(var(--light-safir), var(--dark-safir));
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .file-download a {
    color: light-dark(var(--light-safir), var(--dark-safir));
    text-decoration: none;
    font-weight: 500;
    font-size: 1.05rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .file-download a:hover {
    text-decoration: underline;
  }

  @media (max-width: 768px) {
    .pdf-preview {
      min-height: 400px;
    }

    .pdf-actions {
      flex-direction: column;
      gap: 0.75rem;
    }

    .pdf-actions a {
      justify-content: center;
    }
  }
</style>
