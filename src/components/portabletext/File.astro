---
interface IFileProps {
  node: {
    asset: {
      _ref: string;
      url?: string;
    };
  };
}

const { node } = Astro.props as IFileProps;

// Build Sanity file URL from asset reference
function buildFileUrl(ref: string): string {
  const [, id, extension] = ref.split("-");
  const projectId = import.meta.env.PUBLIC_SANITY_PROJECT_ID;
  if (!projectId) {
    throw new Error("Sanity project ID is not set. Please define PUBLIC_SANITY_PROJECT_ID in your environment variables.");
  }
  return `https://cdn.sanity.io/files/${projectId}/production/${id}.${extension}`;
}

const fileUrl = node.asset?.url || (node.asset?._ref ? buildFileUrl(node.asset._ref) : "");
const fileName = fileUrl.split("/").pop() || "Download file";
---

{
  fileUrl && (
    <div class="file-download">
      <a href={fileUrl} download target="_blank" rel="noopener noreferrer">
        ðŸ“Ž {fileName}
      </a>
    </div>
  )
}

<style>
  .file-download {
    margin: 2rem 0;
    padding: 1.25rem 1.5rem;
    background: light-dark(var(--light-tekstBoks), var(--dark-tekstBoks));
    border-radius: 12px;
    border: 2px solid light-dark(var(--light-ramme), var(--dark-ramme));
    transition: all 0.2s ease;
  }

  .file-download:hover {
    border-color: light-dark(var(--light-safir), var(--dark-safir));
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .file-download a {
    color: light-dark(var(--light-safir), var(--dark-safir));
    text-decoration: none;
    font-weight: 500;
    font-size: 1.05rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .file-download a:hover {
    text-decoration: underline;
  }
</style>
